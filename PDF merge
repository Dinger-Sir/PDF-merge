<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDFä¸å›¾ç‰‡åˆå¹¶å·¥å…·</title>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/downloadjs@1.4.7"></script>
    <style>
        :root {
            --primary-color: #4a6ee0;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --light-bg: #f8f9fa;
            --border-color: #dee2e6;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f7fa;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .description {
            color: var(--secondary-color);
            margin-bottom: 20px;
        }
        
        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            background-color: var(--light-bg);
            margin-bottom: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-area:hover, .upload-area.dragover {
            border-color: var(--primary-color);
            background-color: rgba(74, 110, 224, 0.05);
        }
        
        .upload-icon {
            font-size: 48px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .file-input {
            display: none;
        }
        
        .btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            margin: 5px;
        }
        
        .btn:hover {
            background-color: #3a5bc7;
        }
        
        .btn:disabled {
            background-color: var(--secondary-color);
            cursor: not-allowed;
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        .file-list {
            margin: 20px 0;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            margin-bottom: 10px;
            background-color: white;
        }
        
        .file-icon {
            margin-right: 10px;
            color: var(--primary-color);
        }
        
        .file-name {
            flex-grow: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .file-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--secondary-color);
            font-size: 16px;
        }
        
        .action-btn:hover {
            color: var(--primary-color);
        }
        
        .action-btn.delete:hover {
            color: var(--danger-color);
        }
        
        .merge-options {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--light-bg);
        }
        
        .option-group {
            margin-bottom: 15px;
        }
        
        .option-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .progress-container {
            margin: 20px 0;
            display: none;
        }
        
        .progress-bar {
            height: 10px;
            background-color: var(--border-color);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: var(--primary-color);
            width: 0;
            transition: width 0.3s;
        }
        
        .progress-text {
            text-align: center;
            margin-top: 5px;
            font-size: 14px;
            color: var(--secondary-color);
        }
        
        .result-area {
            margin: 20px 0;
            text-align: center;
            display: none;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: var(--secondary-color);
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .upload-area {
                padding: 30px 15px;
            }
        }
.right-click-tip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            pointer-events: none; /* é˜²æ­¢æç¤ºæ¡†å½±å“é¼ æ ‡äº‹ä»¶ */
        }
       .right-click-tip.show {
            opacity: 1;
        }
    </style>
 <script>
        document.addEventListener('contextmenu', function (e) {
            e.preventDefault();
            const tip = document.getElementById('right-click-tip');
            tip.style.left = e.pageX + 'px';
            tip.style.top = e.pageY + 'px';
            tip.classList.add('show');

            clearTimeout(tip.timer);
            tip.timer = setTimeout(() => {
                tip.classList.remove('show');
            }, 1500);
        });

        document.addEventListener('copy', function (e) {
            e.preventDefault();
            alert('You cannot copy content of this page');
        });

        document.addEventListener('click', function (e) {
            const tip = document.getElementById('right-click-tip');
            if (!tip.contains(e.target)) {
                clearTimeout(tip.timer);
                tip.classList.remove('show');
            }
        });
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>PDFä¸å›¾ç‰‡åˆå¹¶å·¥å…·</h1>
            <p class="description">è½»æ¾åˆå¹¶å¤šä¸ªPDFæ–‡ä»¶æˆ–å°†PDFä¸å›¾ç‰‡åˆå¹¶ä¸ºå•ä¸ªPDFæ–‡æ¡£</p>
        </header>
        
        <main>
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ“„</div>
                <h3>æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </h3>
                <p>æ”¯æŒPDFæ–‡ä»¶å’Œå¸¸è§å›¾ç‰‡æ ¼å¼ï¼ˆJPG, PNG, GIFç­‰ï¼‰</p>
                <input type="file" id="fileInput" class="file-input" multiple accept=".pdf,image/*">
                <button class="btn" id="selectFilesBtn">é€‰æ‹©æ–‡ä»¶</button>
            </div>
            
            <div class="file-list" id="fileList">
                <!-- æ–‡ä»¶åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="merge-options">
                <div class="option-group">
                    <label class="option-label">åˆå¹¶é€‰é¡¹ï¼š</label>
                    <div>
                        <input type="radio" id="mergeAll" name="mergeType" checked>
                        <label for="mergeAll">åˆå¹¶æ‰€æœ‰æ–‡ä»¶ä¸ºä¸€ä¸ªPDF</label>
                    </div>
                    <div>
                        <input type="radio" id="pdfFirst" name="mergeType">
                        <label for="pdfFirst">å°†å›¾ç‰‡æ’å…¥åˆ°ç¬¬ä¸€ä¸ªPDFä¸­</label>
                    </div>
                </div>
                
                <div class="option-group">
                    <label class="option-label">å›¾ç‰‡å¤„ç†ï¼š</label>
                    <div>
                        <input type="checkbox" id="optimizeImages" checked>
                        <label for="optimizeImages">ä¼˜åŒ–å›¾ç‰‡å¤§å°ï¼ˆæ¨èï¼‰</label>
                    </div>
                </div>
            </div>
            
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress" id="progressBar"></div>
                </div>
                <div class="progress-text" id="progressText">æ­£åœ¨å¤„ç†...</div>
            </div>
            
            <button class="btn" id="mergeBtn" disabled>å¼€å§‹åˆå¹¶</button>
            
            <div class="result-area" id="resultArea">
                <h3>åˆå¹¶å®Œæˆï¼</h3>
                <p>æ‚¨çš„PDFæ–‡ä»¶å·²å‡†å¤‡å°±ç»ª</p>
                <button class="btn btn-success" id="downloadBtn">ä¸‹è½½PDF</button>
            </div>
        </main>
        
        <footer>
            <p>æ³¨æ„ï¼šæœ¬å·¥å…·åœ¨æµè§ˆå™¨ä¸­å¤„ç†æ–‡ä»¶ï¼Œæ‚¨çš„æ–‡ä»¶ä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const selectFilesBtn = document.getElementById('selectFilesBtn');
            const fileList = document.getElementById('fileList');
            const mergeBtn = document.getElementById('mergeBtn');
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const resultArea = document.getElementById('resultArea');
            const downloadBtn = document.getElementById('downloadBtn');
            
            let files = [];
            let mergedPdfBytes = null;
            
            // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©
            uploadArea.addEventListener('click', function() {
                fileInput.click();
            });
            
            selectFilesBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                fileInput.click();
            });
            
            // å¤„ç†æ–‡ä»¶é€‰æ‹©
            fileInput.addEventListener('change', function(e) {
                handleFiles(e.target.files);
            });
            
            // æ‹–æ”¾åŠŸèƒ½
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function() {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });
            
            // å¤„ç†é€‰ä¸­çš„æ–‡ä»¶
            function handleFiles(newFiles) {
                for (let i = 0; i < newFiles.length; i++) {
                    const file = newFiles[i];
                    
                    // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                    if (file.type === 'application/pdf' || file.type.startsWith('image/')) {
                        files.push(file);
                    } else {
                        alert(`æ–‡ä»¶ "${file.name}" ä¸æ˜¯PDFæˆ–å›¾ç‰‡æ ¼å¼ï¼Œå·²è·³è¿‡ã€‚`);
                    }
                }
                
                updateFileList();
                updateMergeButton();
            }
            
            // æ›´æ–°æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
            function updateFileList() {
                fileList.innerHTML = '';
                
                if (files.length === 0) {
                    fileList.innerHTML = '<p style="text-align: center; color: var(--secondary-color);">æš‚æ— æ–‡ä»¶</p>';
                    return;
                }
                
                files.forEach((file, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    
                    const fileIcon = file.type === 'application/pdf' ? 'ğŸ“„' : 'ğŸ–¼ï¸';
                    
                    fileItem.innerHTML = `
                        <span class="file-icon">${fileIcon}</span>
                        <span class="file-name">${file.name}</span>
                        <div class="file-actions">
                            <button class="action-btn move-up" data-index="${index}">â†‘</button>
                            <button class="action-btn move-down" data-index="${index}">â†“</button>
                            <button class="action-btn delete" data-index="${index}">Ã—</button>
                        </div>
                    `;
                    
                    fileList.appendChild(fileItem);
                });
                
                // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                document.querySelectorAll('.move-up').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        if (index > 0) {
                            [files[index], files[index-1]] = [files[index-1], files[index]];
                            updateFileList();
                        }
                    });
                });
                
                document.querySelectorAll('.move-down').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        if (index < files.length - 1) {
                            [files[index], files[index+1]] = [files[index+1], files[index]];
                            updateFileList();
                        }
                    });
                });
                
                document.querySelectorAll('.delete').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        files.splice(index, 1);
                        updateFileList();
                        updateMergeButton();
                    });
                });
            }
            
            // æ›´æ–°åˆå¹¶æŒ‰é’®çŠ¶æ€
            function updateMergeButton() {
                mergeBtn.disabled = files.length < 1;
            }
            
            // å¼€å§‹åˆå¹¶
            mergeBtn.addEventListener('click', async function() {
                if (files.length < 1) {
                    alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶');
                    return;
                }
                
                // æ˜¾ç¤ºè¿›åº¦æ¡
                progressContainer.style.display = 'block';
                resultArea.style.display = 'none';
                mergeBtn.disabled = true;
                
                try {
                    // å®é™…åˆå¹¶è¿‡ç¨‹
                    await mergeFiles();
                    
                    // æ˜¾ç¤ºç»“æœåŒºåŸŸ
                    resultArea.style.display = 'block';
                    progressContainer.style.display = 'none';
                } catch (error) {
                    console.error('åˆå¹¶è¿‡ç¨‹ä¸­å‡ºé”™:', error);
                    alert('åˆå¹¶è¿‡ç¨‹ä¸­å‡ºé”™: ' + error.message);
                    progressContainer.style.display = 'none';
                    mergeBtn.disabled = false;
                }
            });
            
            // å®é™…åˆå¹¶æ–‡ä»¶çš„å‡½æ•°
            async function mergeFiles() {
                const { PDFDocument } = PDFLib;
                const mergedPdf = await PDFDocument.create();
                
                // æ›´æ–°è¿›åº¦
                updateProgress(10, 'æ­£åœ¨åˆå§‹åŒ–...');
                
                const mergeType = document.getElementById('mergeAll').checked ? 'all' : 'pdfFirst';
                
                if (mergeType === 'all') {
                    // åˆå¹¶æ‰€æœ‰æ–‡ä»¶
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        
                        updateProgress(10 + (i / files.length) * 80, `æ­£åœ¨å¤„ç†æ–‡ä»¶ ${i+1}/${files.length}...`);
                        
                        if (file.type === 'application/pdf') {
                            // å¤„ç†PDFæ–‡ä»¶
                            const pdfBytes = await readFileAsArrayBuffer(file);
                            const pdfDoc = await PDFDocument.load(pdfBytes);
                            const pages = await mergedPdf.copyPages(pdfDoc, pdfDoc.getPageIndices());
                            pages.forEach(page => mergedPdf.addPage(page));
                        } else {
                            // å¤„ç†å›¾ç‰‡æ–‡ä»¶
                            const imageBytes = await readFileAsArrayBuffer(file);
                            let image;
                            
                            if (file.type === 'image/jpeg') {
                                image = await mergedPdf.embedJpg(imageBytes);
                            } else if (file.type === 'image/png') {
                                image = await mergedPdf.embedPng(imageBytes);
                            } else {
                                // å…¶ä»–å›¾ç‰‡æ ¼å¼ï¼Œå°è¯•ä½œä¸ºPNGå¤„ç†
                                image = await mergedPdf.embedPng(imageBytes);
                            }
                            
                            const page = mergedPdf.addPage();
                            const { width, height } = page.getSize();
                            const imageDims = image.scaleToFit(width, height);
                            
                            page.drawImage(image, {
                                x: (width - imageDims.width) / 2,
                                y: (height - imageDims.height) / 2,
                                width: imageDims.width,
                                height: imageDims.height,
                            });
                        }
                    }
                } else {
                    // å°†å›¾ç‰‡æ’å…¥åˆ°ç¬¬ä¸€ä¸ªPDFä¸­
                    if (files.length === 0 || files[0].type !== 'application/pdf') {
                        throw new Error('ç¬¬ä¸€ä¸ªæ–‡ä»¶å¿…é¡»æ˜¯PDFæ–‡ä»¶');
                    }
                    
                    // åŠ è½½ç¬¬ä¸€ä¸ªPDFæ–‡ä»¶
                    const firstPdfBytes = await readFileAsArrayBuffer(files[0]);
                    const firstPdfDoc = await PDFDocument.load(firstPdfBytes);
                    const pages = await mergedPdf.copyPages(firstPdfDoc, firstPdfDoc.getPageIndices());
                    pages.forEach(page => mergedPdf.addPage(page));
                    
                    updateProgress(30, 'å·²åŠ è½½ç¬¬ä¸€ä¸ªPDFæ–‡ä»¶...');
                    
                    // å¤„ç†å…¶ä»–æ–‡ä»¶ï¼ˆå›¾ç‰‡ï¼‰
                    for (let i = 1; i < files.length; i++) {
                        const file = files[i];
                        
                        updateProgress(30 + ((i-1) / (files.length-1)) * 60, `æ­£åœ¨å¤„ç†å›¾ç‰‡ ${i}/${files.length-1}...`);
                        
                        if (file.type.startsWith('image/')) {
                            const imageBytes = await readFileAsArrayBuffer(file);
                            let image;
                            
                            if (file.type === 'image/jpeg') {
                                image = await mergedPdf.embedJpg(imageBytes);
                            } else if (file.type === 'image/png') {
                                image = await mergedPdf.embedPng(imageBytes);
                            } else {
                                // å…¶ä»–å›¾ç‰‡æ ¼å¼ï¼Œå°è¯•ä½œä¸ºPNGå¤„ç†
                                image = await mergedPdf.embedPng(imageBytes);
                            }
                            
                            const page = mergedPdf.addPage();
                            const { width, height } = page.getSize();
                            const imageDims = image.scaleToFit(width, height);
                            
                            page.drawImage(image, {
                                x: (width - imageDims.width) / 2,
                                y: (height - imageDims.height) / 2,
                                width: imageDims.width,
                                height: imageDims.height,
                            });
                        } else {
                            console.warn(`æ–‡ä»¶ ${file.name} ä¸æ˜¯å›¾ç‰‡ï¼Œå·²è·³è¿‡`);
                        }
                    }
                }
                
                updateProgress(95, 'æ­£åœ¨ç”ŸæˆPDF...');
                
                // ä¿å­˜åˆå¹¶åçš„PDF
                mergedPdfBytes = await mergedPdf.save();
                
                updateProgress(100, 'å®Œæˆï¼');
            }
            
            // è¯»å–æ–‡ä»¶ä¸ºArrayBuffer
            function readFileAsArrayBuffer(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsArrayBuffer(file);
                });
            }
            
            // æ›´æ–°è¿›åº¦æ¡
            function updateProgress(percent, text) {
                progressBar.style.width = `${percent}%`;
                progressText.textContent = text;
            }
            
            // ä¸‹è½½æŒ‰é’®
            downloadBtn.addEventListener('click', function() {
                if (mergedPdfBytes) {
                    const blob = new Blob([mergedPdfBytes], { type: 'application/pdf' });
                    download(blob, 'merged-document.pdf', 'application/pdf');
                } else {
                    alert('æ²¡æœ‰å¯ä¸‹è½½çš„æ–‡ä»¶');
                }
            });
            
            // åˆå§‹åŒ–æ–‡ä»¶åˆ—è¡¨
            updateFileList();
        });
    </script>
</body>
</html>
